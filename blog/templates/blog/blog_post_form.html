{% extends "user/index.html" %}

{% load static %}





{% block content %}

<!-- Plugins css -->
<link href="{% static 'assets/libs/quill/quill.core.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'assets/libs/quill/quill.bubble.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'assets/libs/quill/quill.snow.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'assets/libs/select2/select2.min.css' %}" rel="stylesheet" type="text/css" />


<div id="wrapper">

    <!-- Start Content-->
    <div class="container-fluid">

        <!-- start page title -->
        <div class="row">
            <div class="col-12">
                <div class="page-title-box">
                    <h4 class="page-title">
                        {% if post %}
                            Edit Post
                        {% else %}
                            Create Post
                        {% endif %}
                    </h4>
                    <div class="page-title-right">
                        <ol class="breadcrumb p-0 m-0">
                            <li class="breadcrumb-item"><a href="{% url 'index' %}">Dashboard</a></li>
                            <li class="breadcrumb-item"><a href="{% url 'blog_list' %}">Blog List</a></li>
                            <li class="breadcrumb-item active">
                                {% if post %}
                                    Edit Post
                                {% else %}
                                    Create Post
                                {% endif %}
                            </li>
                        </ol>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>
        <!-- end page title -->

        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Post Editor</h3></div>
                    <div class="card-body">

                        <form method="POST" id="postForm2" onsubmit="formSubmit()">
                            {% csrf_token %}
                            <div class="form-group">
                                <label for="title">Title</label>
                                {{ form.title }}
                            </div>

                            <div class="form-group d-flex align-items-center">
                                <label for="categories" class="mr-2">Categories</label>
                                <div class="select2-container">
                                    <select class="form-control select2-multiple" data-toggle="select2" multiple="multiple" data-placeholder="Choose a Category..." style="width: 50%;">
                                        {% comment %} {{ form.categories }} {% endcomment %}
                                        <option value="#">&nbsp;</option>
                                        {% for category in form.categories %}
                                            <option value="{{ category.pk }}">{{ category }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>

                            <!-- editor -->
                            <div id="snow-editor" style="height: 300px;">
                                {% comment %} <h3><span class="ql-size-large">Hello World!</span></h3>
                                <p>
                                    <br>
                                </p>
                                <h3>This is an simple editable area.</h3>
                                <p>
                                    <br>
                                </p>
                                <ul>
                                    <li>
                                        Select a text to reveal the toolbar.
                                    </li>
                                    <li>
                                        Edit rich document on-the-fly, so elastic!
                                    </li>
                                </ul>
                                <p>
                                    <br>
                                </p>
                                <p>
                                    End of simple area
                                </p> {% endcomment %}

                            </div>
                            <!-- end Snow-editor-->

                            <!-- Hidden field to submit body content -->
                            <input type="hidden" id="post-body" name="body" value="{{ form.body.value|safe }}">

                            <div class="d-flex justify-content-end mt-3">
                                <button type="submit" class="btn btn-primary">
                                    {% if post %}
                                        Edit Post
                                    {% else %}
                                        Create Post
                                    {% endif %}
                                </button>
                            </div>

                        </form>
                    </div>
                    <!-- end card-body-->
                </div>
                <!-- end card-->
            </div>
            <!-- end col -->
        </div>
        <!-- end row -->

    </div>
    <!-- end container-fluid -->

</div>


<!-- Plugins js -->
<script src="{% static 'assets/libs/select2/select2.min.js' %}"></script>
<script src="{% static 'assets/libs/katex/katex.min.js' %}"></script>
<script src="{% static 'assets/libs/quill/quill.min.js' %}"></script>


<!-- Init js-->
<!-- <script src="{% static 'assets/js/pages/form-quilljs.init.js' %}"></script> -->
{% comment %} <script src="{% static 'assets/js/pages/form-advanced.init.js' %}"></script> {% endcomment %}



<!-- Select2 -->

<script>
    $(document).ready(function() {
        !function(o) {
            "use strict";
            
            var t = function() {};

            t.prototype.initSelect2 = function() {
                o('[data-toggle="select2"]').select2({
                    placeholder: "Choose a Category...",
                    allowClear: true // Allows clearing the selection
                });
            };

            t.prototype.init = function() {
                this.initSelect2();
            };

            o.Components = new t;
            o.Components.Constructor = t;

        }(window.jQuery), function(t) {
            "use strict";
            window.jQuery.Components.init();
        }();
    });
</script>

<!-- On form submit, copy Quill content to the hidden textarea -->
<script>
var quill = new Quill("#snow-editor", {
    theme: "snow",
    modules: {
        toolbar: [
            [{ font: [] }, { size: [] }],
            ["bold", "italic", "underline", "strike"],
            [{ color: [] }, { background: [] }],
            [{ script: "super" }, { script: "sub" }],
            [{ header: [false, 1, 2, 3, 4, 5, 6] }, "blockquote", "code-block"],
            [{ list: "ordered" }, { list: "bullet" }, { indent: "-1" }, { indent: "+1" }],
            ["direction", { align: [] }],
            ["link", "image", "video", "formula"],
            ["clean"]
        ]
    }
});

// Load existing content into the Quill editor when editing
var existingContent = document.getElementById("post-body").value;
if (existingContent) {
    quill.root.innerHTML = existingContent;  // Set the existing content to Quill editor
}

    // Submit and save the form (post content)
    function formSubmit() {
        console.log("form submitted")
        document.getElementById("post-body").value = quill.root.innerHTML;  
      }

</script>




{% endblock  %}

